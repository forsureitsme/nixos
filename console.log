 ✘ piter@nixos  /mnt/c/Users/Administrator/projects  sudo nixos-rebuild switch --impure --flake ./nixos#piter-microstar --show-trace
warning: Git tree '/mnt/c/Users/Administrator/projects/nixos' is dirty
building the system configuration...
warning: Git tree '/mnt/c/Users/Administrator/projects/nixos' is dirty
error:
       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1571:24:

         1570|     let f = attrPath:
         1571|       zipAttrsWith (n: values:
             |                        ^
         1572|         let here = attrPath ++ [n]; in

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1205:18:

         1204|         mapAttrs
         1205|           (name: value:
             |                  ^
         1206|             if isAttrs value && cond value

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1208:18:

         1207|             then recurse (path ++ [ name ]) value
         1208|             else f (path ++ [ name ]) value);
             |                  ^
         1209|     in

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:254:72:

          253|           # For definitions that have an associated option
          254|           declaredConfig = mapAttrsRecursiveCond (v: ! isOption v) (_: v: v.value) options;
             |                                                                        ^
          255|

       … while evaluating the option `system.build.toplevel':

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:836:28:

          835|         # Process mkMerge and mkIf properties.
          836|         defs' = concatMap (m:
             |                            ^
          837|           map (value: { inherit (m) file; inherit value; }) (addErrorContext "while evaluating definitions from `${m.file}':" (dischargeProperties m.value))

       … while evaluating definitions from `/nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/nixos/modules/system/activation/top-level.nix':

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:837:128:

          836|         defs' = concatMap (m:
          837|           map (value: { inherit (m) file; inherit value; }) (addErrorContext "while evaluating definitions from `${m.file}':" (dischargeProperties m.value))
             |                                                                                                                                ^
          838|         ) defs;

       … while calling 'dischargeProperties'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:908:25:

          907|   */
          908|   dischargeProperties = def:
             |                         ^
          909|     if def._type or "" == "merge" then

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/nixos/modules/system/activation/top-level.nix:71:12:

           70|   # Replace runtime dependencies
           71|   system = foldr ({ oldDependency, newDependency }: drv:
             |            ^
           72|       pkgs.replaceDependency { inherit oldDependency newDependency drv; }

       … while calling 'foldr'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:121:20:

          120|   */
          121|   foldr = op: nul: list:
             |                    ^
          122|     let

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:128:8:

          127|         else op (elemAt list n) (fold' (n + 1));
          128|     in fold' 0;
             |        ^
          129|

       … while calling 'fold''

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:124:15:

          123|       len = length list;
          124|       fold' = n:
             |               ^
          125|         if n == len

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1205:18:

         1204|         mapAttrs
         1205|           (name: value:
             |                  ^
         1206|             if isAttrs value && cond value

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1208:18:

         1207|             then recurse (path ++ [ name ]) value
         1208|             else f (path ++ [ name ]) value);
             |                  ^
         1209|     in

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:254:72:

          253|           # For definitions that have an associated option
          254|           declaredConfig = mapAttrsRecursiveCond (v: ! isOption v) (_: v: v.value) options;
             |                                                                        ^
          255|

       … while evaluating the option `assertions':

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:836:28:

          835|         # Process mkMerge and mkIf properties.
          836|         defs' = concatMap (m:
             |                            ^
          837|           map (value: { inherit (m) file; inherit value; }) (addErrorContext "while evaluating definitions from `${m.file}':" (dischargeProperties m.value))

       … while evaluating definitions from `/nix/store/2s0q097kq3swvdv38q110ssvhaq95fcg-source/nixos/common.nix':

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:837:128:

          836|         defs' = concatMap (m:
          837|           map (value: { inherit (m) file; inherit value; }) (addErrorContext "while evaluating definitions from `${m.file}':" (dischargeProperties m.value))
             |                                                                                                                                ^
          838|         ) defs;

       … while calling 'dischargeProperties'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:908:25:

          907|   */
          908|   dischargeProperties = def:
             |                         ^
          909|     if def._type or "" == "merge" then

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:914:11:

          913|         if def.condition then
          914|           dischargeProperties def.content
             |           ^
          915|         else

       … while calling 'dischargeProperties'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:908:25:

          907|   */
          908|   dischargeProperties = def:
             |                         ^
          909|     if def._type or "" == "merge" then

       … from call site

         at /nix/store/2s0q097kq3swvdv38q110ssvhaq95fcg-source/nixos/common.nix:110:20:

          109|
          110|       assertions = flatten (flip mapAttrsToList cfg.users (user: config:
             |                    ^
          111|         flip map config.assertions (assertion: {

       … while calling 'flatten'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:431:13:

          430|   */
          431|   flatten = x:
             |             ^
          432|     if isList x

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:433:21:

          432|     if isList x
          433|     then concatMap (y: flatten y) x
             |                     ^
          434|     else [x];

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:433:24:

          432|     if isList x
          433|     then concatMap (y: flatten y) x
             |                        ^
          434|     else [x];

       … while calling 'flatten'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:431:13:

          430|   */
          431|   flatten = x:
             |             ^
          432|     if isList x

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1096:10:

         1095|     attrs:
         1096|     map (name: f name attrs.${name}) (attrNames attrs);
             |          ^
         1097|

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1096:16:

         1095|     attrs:
         1096|     map (name: f name attrs.${name}) (attrNames attrs);
             |                ^
         1097|

       … while calling anonymous lambda

         at /nix/store/2s0q097kq3swvdv38q110ssvhaq95fcg-source/nixos/common.nix:110:66:

          109|
          110|       assertions = flatten (flip mapAttrsToList cfg.users (user: config:
             |                                                                  ^
          111|         flip map config.assertions (assertion: {

       … from call site

         at /nix/store/2s0q097kq3swvdv38q110ssvhaq95fcg-source/nixos/common.nix:111:9:

          110|       assertions = flatten (flip mapAttrsToList cfg.users (user: config:
          111|         flip map config.assertions (assertion: {
             |         ^
          112|           inherit (assertion) assertion;

       … while calling 'flip'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/trivial.nix:317:16:

          316|   */
          317|   flip = f: a: b: f b a;
             |                ^
          318|

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/types.nix:583:22:

          582|       merge = loc: defs:
          583|         mapAttrs (n: v: v.value) (filterAttrs (n: v: v ? value) (zipAttrsWith (name: defs:
             |                      ^
          584|             (mergeDefinitions (loc ++ [name]) elemType defs).optionalValue

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:858:59:

          857|       if isDefined then
          858|         if all (def: type.check def.value) defsFinal then type.merge loc defsFinal
             |                                                           ^
          859|         else let allInvalid = filter (def: ! type.check def.value) defsFinal;

       … while calling 'merge'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/types.nix:887:22:

          886|         check = x: isAttrs x || isFunction x || path.check x;
          887|         merge = loc: defs:
             |                      ^
          888|           (base.extendModules {

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:254:28:

          253|           # For definitions that have an associated option
          254|           declaredConfig = mapAttrsRecursiveCond (v: ! isOption v) (_: v: v.value) options;
             |                            ^
          255|

       … while calling 'mapAttrsRecursiveCond'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/attrsets.nix:1201:5:

         1200|     f:
         1201|     set:
             |     ^
         1202|     let

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:246:33:

          245|           ({ inherit lib options config specialArgs; } // specialArgs);
          246|         in mergeModules prefix (reverseList collected);
             |                                 ^
          247|

       … while calling 'reverseList'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:1116:17:

         1115|   */
         1116|   reverseList = xs:
             |                 ^
         1117|     let l = length xs; in genList (n: elemAt xs (l - n - 1)) l;

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:241:25:

          240|       merged =
          241|         let collected = collectModules
             |                         ^
          242|           class

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:457:37:

          456|
          457|     in modulesPath: initialModules: args:
             |                                     ^
          458|       filterModules modulesPath (collectStructuredModules unknownModule "" initialModules args);

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:458:7:

          457|     in modulesPath: initialModules: args:
          458|       filterModules modulesPath (collectStructuredModules unknownModule "" initialModules args);
             |       ^
          459|

       … while calling 'filterModules'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:425:36:

          424|       # modules recursively. It returns the final list of unique-by-key modules
          425|       filterModules = modulesPath: { disabled, modules }:
             |                                    ^
          426|         let

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:451:31:

          450|           disabledKeys = concatMap ({ file, disabled }: map (moduleKey file) disabled) disabled;
          451|           keyFilter = filter (attrs: ! elem attrs.key disabledKeys);
             |                               ^
          452|         in map (attrs: attrs.module) (genericClosure {

       … from call site

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:410:73:

          409|           };
          410|         in parentFile: parentKey: initialModules: args: collectResults (imap1 (n: x:
             |                                                                         ^
          411|           let

       … while calling 'imap1'

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/lists.nix:334:14:

          333|   */
          334|   imap1 = f: list: genList (n: f (n + 1) (elemAt list n)) (length list);
             |              ^
          335|

       … while calling anonymous lambda

         at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:518:35:

          517|       context = name: ''while evaluating the module argument `${name}' in "${key}":'';
          518|       extraArgs = mapAttrs (name: _:
             |                                   ^
          519|         addErrorContext (context name)

       … while evaluating the module argument `builtins' in ":anon-5:anon-1":

       error: infinite recursion encountered

       at /nix/store/qpg5mwsind2hy35b9vpk6mx4jimnypw0-source/lib/modules.nix:520:28:

          519|         addErrorContext (context name)
          520|           (args.${name} or config._module.args.${name})
             |                            ^
          521|       ) (functionArgs f);